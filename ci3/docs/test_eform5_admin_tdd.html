<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EForm5 å¾Œå°ç®¡ç†ç³»çµ± TDD æ¸¬è©¦</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .test-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-title {
            color: #6f42c1;
            border-bottom: 2px solid #6f42c1;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .test-group {
            margin-bottom: 30px;
            border-left: 4px solid #6f42c1;
            padding-left: 20px;
        }
        .test-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        .test-status {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 12px;
        }
        .status-pending { background-color: #6c757d; }
        .status-running { background-color: #ffc107; }
        .status-pass { background-color: #28a745; }
        .status-fail { background-color: #dc3545; }
        .test-button {
            padding: 8px 15px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-primary { background-color: #6f42c1; color: white; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-warning { background-color: #ffc107; color: black; }
        .btn-danger { background-color: #dc3545; color: white; }
        .test-results {
            margin-top: 20px;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 5px;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
        }
        .api-endpoint {
            background-color: #e9ecef;
            padding: 5px 10px;
            border-radius: 3px;
            font-family: monospace;
            margin: 0 5px;
        }
        .test-data {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .summary {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
        }
        .summary-item {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            color: white;
        }
        .summary-total { background-color: #6f42c1; }
        .summary-pass { background-color: #28a745; }
        .summary-fail { background-color: #dc3545; }
        .summary-pending { background-color: #6c757d; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="test-title">EForm5 å€‹äººé«”æ¸¬è¡¨+å¥åº·è«®è©¢è¡¨ å¾Œå°ç®¡ç†ç³»çµ± TDD æ¸¬è©¦</h1>
        
        <!-- æ¸¬è©¦æ‘˜è¦ -->
        <div class="summary">
            <div class="summary-item summary-total">
                <h3 id="total-tests">0</h3>
                <p>ç¸½æ¸¬è©¦æ•¸</p>
            </div>
            <div class="summary-item summary-pass">
                <h3 id="pass-tests">0</h3>
                <p>é€šé</p>
            </div>
            <div class="summary-item summary-fail">
                <h3 id="fail-tests">0</h3>
                <p>å¤±æ•—</p>
            </div>
            <div class="summary-item summary-pending">
                <h3 id="pending-tests">0</h3>
                <p>å¾…æ¸¬è©¦</p>
            </div>
        </div>

        <!-- å…¨åŸŸæ§åˆ¶ -->
        <div style="text-align: center; margin-bottom: 30px;">
            <button class="test-button btn-primary" onclick="runAllTests()">åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦</button>
            <button class="test-button btn-warning" onclick="resetTests()">é‡ç½®æ¸¬è©¦</button>
            <button class="test-button btn-success" onclick="exportResults()">åŒ¯å‡ºçµæœ</button>
        </div>
    </div>

    <!-- æ¸¬è©¦çµ„åˆ¥ 1: API ç«¯é»æ¸¬è©¦ -->
    <div class="test-container">
        <div class="test-group">
            <h3>ğŸ“¡ API ç«¯é»æ¸¬è©¦</h3>
            
            <div class="test-item" data-test="api-list">
                <div class="test-status status-pending">?</div>
                <div style="flex: 1;">
                    <strong>åˆ—è¡¨ API</strong>
                    <div class="api-endpoint">GET /api/eeform/eeform5/list</div>
                    <small>æ¸¬è©¦åˆ†é åˆ—è¡¨åŠŸèƒ½ã€æœå°‹ã€ç¯©é¸</small>
                </div>
                <button class="test-button btn-primary" onclick="testApiList()">æ¸¬è©¦</button>
            </div>

            <div class="test-item" data-test="api-get">
                <div class="test-status status-pending">?</div>
                <div style="flex: 1;">
                    <strong>å–®ç­†è³‡æ–™ API</strong>
                    <div class="api-endpoint">GET /api/eeform/eeform5/submission/{id}</div>
                    <small>æ¸¬è©¦ç²å–å–®ç­†è©³ç´°è³‡æ–™</small>
                </div>
                <button class="test-button btn-primary" onclick="testApiGet()">æ¸¬è©¦</button>
            </div>

            <div class="test-item" data-test="api-export">
                <div class="test-status status-pending">?</div>
                <div style="flex: 1;">
                    <strong>åŒ¯å‡º API</strong>
                    <div class="api-endpoint">GET /api/eeform/eeform5/export_single/{id}</div>
                    <small>æ¸¬è©¦ExcelåŒ¯å‡ºåŠŸèƒ½</small>
                </div>
                <button class="test-button btn-primary" onclick="testApiExport()">æ¸¬è©¦</button>
            </div>

            <div class="test-item" data-test="api-comprehensive">
                <div class="test-status status-pending">?</div>
                <div style="flex: 1;">
                    <strong>ç¶œåˆæ¸¬è©¦ API</strong>
                    <div class="api-endpoint">POST /api/eeform/eeform5/comprehensive_test</div>
                    <small>æ¸¬è©¦å®Œæ•´çš„è¡¨å–®æäº¤å’Œé©—è­‰æµç¨‹</small>
                </div>
                <button class="test-button btn-primary" onclick="testApiComprehensive()">æ¸¬è©¦</button>
            </div>
        </div>
    </div>

    <!-- æ¸¬è©¦çµ„åˆ¥ 2: å‰ç«¯åŠŸèƒ½æ¸¬è©¦ -->
    <div class="test-container">
        <div class="test-group">
            <h3>ğŸ–¥ï¸ å‰ç«¯åŠŸèƒ½æ¸¬è©¦</h3>
            
            <div class="test-item" data-test="frontend-load">
                <div class="test-status status-pending">?</div>
                <div style="flex: 1;">
                    <strong>é é¢è¼‰å…¥</strong>
                    <small>æ¸¬è©¦ç®¡ç†é é¢æ˜¯å¦æ­£ç¢ºè¼‰å…¥æ‰€æœ‰å¿…è¦å…ƒä»¶</small>
                </div>
                <button class="test-button btn-primary" onclick="testFrontendLoad()">æ¸¬è©¦</button>
            </div>

            <div class="test-item" data-test="frontend-table">
                <div class="test-status status-pending">?</div>
                <div style="flex: 1;">
                    <strong>è³‡æ–™è¡¨æ ¼</strong>
                    <small>æ¸¬è©¦è¡¨æ ¼é¡¯ç¤ºã€åˆ†é ã€æœå°‹åŠŸèƒ½</small>
                </div>
                <button class="test-button btn-primary" onclick="testFrontendTable()">æ¸¬è©¦</button>
            </div>

            <div class="test-item" data-test="frontend-modal">
                <div class="test-status status-pending">?</div>
                <div style="flex: 1;">
                    <strong>è©³ç´°è³‡æ–™å½ˆçª—</strong>
                    <small>æ¸¬è©¦å½ˆçª—é–‹å•Ÿã€è³‡æ–™é¡¯ç¤ºã€é—œé–‰åŠŸèƒ½</small>
                </div>
                <button class="test-button btn-primary" onclick="testFrontendModal()">æ¸¬è©¦</button>
            </div>

            <div class="test-item" data-test="frontend-export">
                <div class="test-status status-pending">?</div>
                <div style="flex: 1;">
                    <strong>åŒ¯å‡ºåŠŸèƒ½</strong>
                    <small>æ¸¬è©¦ExcelåŒ¯å‡ºæŒ‰éˆ•å’Œä¸‹è¼‰åŠŸèƒ½</small>
                </div>
                <button class="test-button btn-primary" onclick="testFrontendExport()">æ¸¬è©¦</button>
            </div>
        </div>
    </div>

    <!-- æ¸¬è©¦çµ„åˆ¥ 3: è³‡æ–™å®Œæ•´æ€§æ¸¬è©¦ -->
    <div class="test-container">
        <div class="test-group">
            <h3>ğŸ—„ï¸ è³‡æ–™å®Œæ•´æ€§æ¸¬è©¦</h3>
            
            <div class="test-item" data-test="data-structure">
                <div class="test-status status-pending">?</div>
                <div style="flex: 1;">
                    <strong>è³‡æ–™çµæ§‹é©—è­‰</strong>
                    <small>é©—è­‰APIå›å‚³è³‡æ–™çµæ§‹æ˜¯å¦ç¬¦åˆé æœŸ</small>
                </div>
                <button class="test-button btn-primary" onclick="testDataStructure()">æ¸¬è©¦</button>
            </div>

            <div class="test-item" data-test="data-fields">
                <div class="test-status status-pending">?</div>
                <div style="flex: 1;">
                    <strong>å¿…è¦æ¬„ä½æª¢æŸ¥</strong>
                    <small>æª¢æŸ¥æ‰€æœ‰å¿…è¦æ¬„ä½æ˜¯å¦å­˜åœ¨ä¸”æ ¼å¼æ­£ç¢º</small>
                </div>
                <button class="test-button btn-primary" onclick="testDataFields()">æ¸¬è©¦</button>
            </div>

            <div class="test-item" data-test="data-relations">
                <div class="test-status status-pending">?</div>
                <div style="flex: 1;">
                    <strong>é—œè¯è³‡æ–™é©—è­‰</strong>
                    <small>é©—è­‰è·æ¥­ã€å¥åº·å›°æ“¾ã€ç”¢å“æ¨è–¦ç­‰é—œè¯è³‡æ–™</small>
                </div>
                <button class="test-button btn-primary" onclick="testDataRelations()">æ¸¬è©¦</button>
            </div>
        </div>
    </div>

    <!-- æ¸¬è©¦çµ„åˆ¥ 4: ä½¿ç”¨è€…äº’å‹•æ¸¬è©¦ -->
    <div class="test-container">
        <div class="test-group">
            <h3>ğŸ‘¤ ä½¿ç”¨è€…äº’å‹•æ¸¬è©¦</h3>
            
            <div class="test-item" data-test="ui-responsive">
                <div class="test-status status-pending">?</div>
                <div style="flex: 1;">
                    <strong>éŸ¿æ‡‰å¼è¨­è¨ˆ</strong>
                    <small>æ¸¬è©¦åœ¨ä¸åŒè¢å¹•å°ºå¯¸ä¸‹çš„é¡¯ç¤ºæ•ˆæœ</small>
                </div>
                <button class="test-button btn-primary" onclick="testUIResponsive()">æ¸¬è©¦</button>
            </div>

            <div class="test-item" data-test="ui-accessibility">
                <div class="test-status status-pending">?</div>
                <div style="flex: 1;">
                    <strong>ç„¡éšœç¤™åŠŸèƒ½</strong>
                    <small>æª¢æŸ¥æŒ‰éˆ•hoveræ•ˆæœã€tooltipç­‰äº’å‹•åŠŸèƒ½</small>
                </div>
                <button class="test-button btn-primary" onclick="testUIAccessibility()">æ¸¬è©¦</button>
            </div>

            <div class="test-item" data-test="ui-error-handling">
                <div class="test-status status-pending">?</div>
                <div style="flex: 1;">
                    <strong>éŒ¯èª¤è™•ç†</strong>
                    <small>æ¸¬è©¦APIéŒ¯èª¤ã€ç¶²è·¯éŒ¯èª¤æ™‚çš„ä½¿ç”¨è€…æç¤º</small>
                </div>
                <button class="test-button btn-primary" onclick="testUIErrorHandling()">æ¸¬è©¦</button>
            </div>
        </div>
    </div>

    <!-- æ¸¬è©¦çµæœé¡¯ç¤ºå€ -->
    <div class="test-container">
        <h3>ğŸ“Š æ¸¬è©¦çµæœ</h3>
        <div class="test-results" id="test-results">
            <div style="color: #6c757d;">ç­‰å¾…æ¸¬è©¦åŸ·è¡Œ...</div>
        </div>
    </div>

    <script>
        // æ¸¬è©¦ç‹€æ…‹ç®¡ç†
        const testResults = {
            total: 0,
            pass: 0,
            fail: 0,
            pending: 0,
            results: []
        };

        // API Base URL
        const API_BASE_URL = '/api/eeform/eeform5';

        // æ¸¬è©¦ç”¨è³‡æ–™
        const testData = {
            member_name: 'æ¸¬è©¦ä½¿ç”¨è€…',
            member_id: '000000',
            phone: '0912345678',
            gender: 'ç”·',
            age: 30,
            height: '170',
            exercise_habit: 'æ˜¯',
            weight: 70.2,
            bmi: 24.3,
            fat_percentage: 15.8,
            occupation: ['ä¸Šç­æ—'],
            health_concerns: ['ç¡çœ ä¸ä½³', 'å…ç–«åŠ›'],
            recommended_products: ['æ´»åŠ›ç²¾èƒ', 'ç™½é¶´éˆèŠEX'],
            health_concerns_other: 'å¶çˆ¾å¤±çœ '
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeTests();
            updateSummary();
        });

        function initializeTests() {
            const testItems = document.querySelectorAll('[data-test]');
            testResults.total = testItems.length;
            testResults.pending = testItems.length;
            updateSummary();
            log('ç³»çµ±åˆå§‹åŒ–å®Œæˆï¼Œå…± ' + testResults.total + ' å€‹æ¸¬è©¦é …ç›®');
        }

        function updateSummary() {
            document.getElementById('total-tests').textContent = testResults.total;
            document.getElementById('pass-tests').textContent = testResults.pass;
            document.getElementById('fail-tests').textContent = testResults.fail;
            document.getElementById('pending-tests').textContent = testResults.pending;
        }

        function updateTestStatus(testId, status, message = '') {
            const testItem = document.querySelector(`[data-test="${testId}"]`);
            if (!testItem) return;

            const statusElement = testItem.querySelector('.test-status');
            statusElement.className = `test-status status-${status}`;
            
            switch(status) {
                case 'running':
                    statusElement.textContent = 'âŸ³';
                    break;
                case 'pass':
                    statusElement.textContent = 'âœ“';
                    testResults.pass++;
                    testResults.pending--;
                    break;
                case 'fail':
                    statusElement.textContent = 'âœ—';
                    testResults.fail++;
                    testResults.pending--;
                    break;
                default:
                    statusElement.textContent = '?';
            }

            updateSummary();
            
            if (message) {
                log(`[${testId.toUpperCase()}] ${message}`);
            }
        }

        function log(message) {
            const resultsElement = document.getElementById('test-results');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            resultsElement.innerHTML += logEntry;
            resultsElement.scrollTop = resultsElement.scrollHeight;
        }

        // API æ¸¬è©¦å‡½æ•¸
        async function testApiList() {
            updateTestStatus('api-list', 'running');
            
            try {
                const response = await fetch(`${API_BASE_URL}/list?page=1&limit=5`);
                const data = await response.json();
                
                if (data.success && data.data && data.data.data) {
                    updateTestStatus('api-list', 'pass', 'åˆ—è¡¨APIæ¸¬è©¦é€šé');
                    log(`å›å‚³ ${data.data.data.length} ç­†è³‡æ–™`);
                } else {
                    updateTestStatus('api-list', 'fail', `åˆ—è¡¨APIæ¸¬è©¦å¤±æ•—: ${data.message || 'æœªçŸ¥éŒ¯èª¤'}`);
                }
            } catch (error) {
                updateTestStatus('api-list', 'fail', `åˆ—è¡¨APIæ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }

        async function testApiGet() {
            updateTestStatus('api-get', 'running');
            
            try {
                // å…ˆç²å–åˆ—è¡¨æ‰¾ä¸€å€‹ID
                const listResponse = await fetch(`${API_BASE_URL}/list?page=1&limit=1`);
                const listData = await listResponse.json();
                
                if (listData.success && listData.data.data.length > 0) {
                    const testId = listData.data.data[0].id;
                    
                    const response = await fetch(`${API_BASE_URL}/submission/${testId}`);
                    const data = await response.json();
                    
                    if (data.success && data.data) {
                        updateTestStatus('api-get', 'pass', 'å–®ç­†è³‡æ–™APIæ¸¬è©¦é€šé');
                        log(`æˆåŠŸç²å–ID ${testId} çš„è©³ç´°è³‡æ–™`);
                    } else {
                        updateTestStatus('api-get', 'fail', `å–®ç­†è³‡æ–™APIæ¸¬è©¦å¤±æ•—: ${data.message || 'æœªçŸ¥éŒ¯èª¤'}`);
                    }
                } else {
                    updateTestStatus('api-get', 'fail', 'ç„¡æ³•ç²å–æ¸¬è©¦ç”¨ID');
                }
            } catch (error) {
                updateTestStatus('api-get', 'fail', `å–®ç­†è³‡æ–™APIæ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }

        async function testApiExport() {
            updateTestStatus('api-export', 'running');
            
            try {
                // å…ˆç²å–åˆ—è¡¨æ‰¾ä¸€å€‹ID
                const listResponse = await fetch(`${API_BASE_URL}/list?page=1&limit=1`);
                const listData = await listResponse.json();
                
                if (listData.success && listData.data.data.length > 0) {
                    const testId = listData.data.data[0].id;
                    
                    const response = await fetch(`${API_BASE_URL}/export_single/${testId}`, {
                        method: 'GET'
                    });
                    
                    if (response.ok) {
                        const contentType = response.headers.get('content-type');
                        if (contentType && contentType.includes('spreadsheet')) {
                            updateTestStatus('api-export', 'pass', 'ExcelåŒ¯å‡ºAPIæ¸¬è©¦é€šé');
                            log(`æˆåŠŸç”ŸæˆID ${testId} çš„Excelæª”æ¡ˆ`);
                        } else {
                            updateTestStatus('api-export', 'fail', 'å›å‚³æª”æ¡ˆæ ¼å¼ä¸æ­£ç¢º');
                        }
                    } else {
                        updateTestStatus('api-export', 'fail', `HTTPéŒ¯èª¤: ${response.status}`);
                    }
                } else {
                    updateTestStatus('api-export', 'fail', 'ç„¡æ³•ç²å–æ¸¬è©¦ç”¨ID');
                }
            } catch (error) {
                updateTestStatus('api-export', 'fail', `åŒ¯å‡ºAPIæ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }

        async function testApiComprehensive() {
            updateTestStatus('api-comprehensive', 'running');
            
            try {
                const response = await fetch(`${API_BASE_URL}/comprehensive_test`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (data.success && data.data && data.data.verification && data.data.verification.overall_success) {
                    updateTestStatus('api-comprehensive', 'pass', 'ç¶œåˆæ¸¬è©¦APIé€šé');
                    log(`æ¸¬è©¦è³‡æ–™æˆåŠŸå¯«å…¥ï¼Œæäº¤ID: ${data.data.submission_id}`);
                    log(`é©—è­‰çµæœ: ${JSON.stringify(data.summary, null, 2)}`);
                } else {
                    updateTestStatus('api-comprehensive', 'fail', `ç¶œåˆæ¸¬è©¦å¤±æ•—: ${data.message || 'é©—è­‰æœªé€šé'}`);
                }
            } catch (error) {
                updateTestStatus('api-comprehensive', 'fail', `ç¶œåˆæ¸¬è©¦APIå¤±æ•—: ${error.message}`);
            }
        }

        // å‰ç«¯åŠŸèƒ½æ¸¬è©¦
        function testFrontendLoad() {
            updateTestStatus('frontend-load', 'running');
            
            try {
                // æª¢æŸ¥å¿…è¦å…ƒç´ æ˜¯å¦å­˜åœ¨
                const requiredElements = [
                    'h2', // æ¨™é¡Œ
                    '.table-responsive table', // è³‡æ–™è¡¨æ ¼
                    '#detailModal', // è©³ç´°è³‡æ–™å½ˆçª—
                    '#search-input', // æœå°‹è¼¸å…¥
                    '#refresh-data' // é‡æ–°æ•´ç†æŒ‰éˆ•
                ];
                
                let allExists = true;
                let missingElements = [];
                
                requiredElements.forEach(selector => {
                    const element = document.querySelector(selector);
                    if (!element) {
                        allExists = false;
                        missingElements.push(selector);
                    }
                });
                
                if (allExists) {
                    updateTestStatus('frontend-load', 'pass', 'æ‰€æœ‰å¿…è¦å…ƒç´ éƒ½å­˜åœ¨');
                } else {
                    updateTestStatus('frontend-load', 'fail', `ç¼ºå°‘å…ƒç´ : ${missingElements.join(', ')}`);
                }
            } catch (error) {
                updateTestStatus('frontend-load', 'fail', `å‰ç«¯è¼‰å…¥æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }

        function testFrontendTable() {
            updateTestStatus('frontend-table', 'running');
            
            setTimeout(() => {
                try {
                    // æª¢æŸ¥è¡¨æ ¼çµæ§‹
                    const table = document.querySelector('.table-responsive table');
                    const headers = table.querySelectorAll('thead th');
                    const expectedHeaders = ['ID', 'æœƒå“¡å§“å', 'å‡ºç”Ÿå¹´æœˆ', 'èº«é«˜', 'ç”¨è—¥ç¿’æ…£', 'å®¶æ—ç—…å²', 'æäº¤æ—¥æœŸ', 'æ“ä½œ'];
                    
                    if (headers.length >= expectedHeaders.length - 1) { // IDå¯èƒ½éš±è—
                        updateTestStatus('frontend-table', 'pass', 'è¡¨æ ¼çµæ§‹æ­£ç¢º');
                    } else {
                        updateTestStatus('frontend-table', 'fail', `è¡¨æ ¼æ¬„ä½æ•¸é‡ä¸æ­£ç¢º: ${headers.length}`);
                    }
                } catch (error) {
                    updateTestStatus('frontend-table', 'fail', `è¡¨æ ¼æ¸¬è©¦å¤±æ•—: ${error.message}`);
                }
            }, 1000);
        }

        function testFrontendModal() {
            updateTestStatus('frontend-modal', 'running');
            
            try {
                const modal = document.getElementById('detailModal');
                if (modal && modal.querySelector('.modal-body') && modal.querySelector('.modal-header')) {
                    updateTestStatus('frontend-modal', 'pass', 'å½ˆçª—çµæ§‹æ­£ç¢º');
                } else {
                    updateTestStatus('frontend-modal', 'fail', 'å½ˆçª—çµæ§‹ä¸å®Œæ•´');
                }
            } catch (error) {
                updateTestStatus('frontend-modal', 'fail', `å½ˆçª—æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }

        function testFrontendExport() {
            updateTestStatus('frontend-export', 'running');
            
            try {
                // æª¢æŸ¥æ˜¯å¦æœ‰åŒ¯å‡ºæŒ‰éˆ•æˆ–åŠŸèƒ½
                const exportButtons = document.querySelectorAll('[onclick*="export"]');
                if (exportButtons.length > 0) {
                    updateTestStatus('frontend-export', 'pass', `æ‰¾åˆ° ${exportButtons.length} å€‹åŒ¯å‡ºæŒ‰éˆ•`);
                } else {
                    updateTestStatus('frontend-export', 'fail', 'æœªæ‰¾åˆ°åŒ¯å‡ºæŒ‰éˆ•');
                }
            } catch (error) {
                updateTestStatus('frontend-export', 'fail', `åŒ¯å‡ºåŠŸèƒ½æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }

        // è³‡æ–™å®Œæ•´æ€§æ¸¬è©¦
        async function testDataStructure() {
            updateTestStatus('data-structure', 'running');
            
            try {
                const response = await fetch(`${API_BASE_URL}/list?page=1&limit=1`);
                const data = await response.json();
                
                if (data.success && data.data && data.data.data) {
                    const requiredFields = ['id', 'member_name', 'submission_date'];
                    const firstItem = data.data.data[0];
                    
                    if (firstItem) {
                        const hasRequiredFields = requiredFields.every(field => firstItem.hasOwnProperty(field));
                        if (hasRequiredFields) {
                            updateTestStatus('data-structure', 'pass', 'è³‡æ–™çµæ§‹é©—è­‰é€šé');
                        } else {
                            updateTestStatus('data-structure', 'fail', 'ç¼ºå°‘å¿…è¦æ¬„ä½');
                        }
                    } else {
                        updateTestStatus('data-structure', 'pass', 'æš«ç„¡è³‡æ–™ï¼Œçµæ§‹æª¢æŸ¥ç•¥é');
                    }
                } else {
                    updateTestStatus('data-structure', 'fail', 'APIå›å‚³æ ¼å¼éŒ¯èª¤');
                }
            } catch (error) {
                updateTestStatus('data-structure', 'fail', `è³‡æ–™çµæ§‹æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }

        async function testDataFields() {
            updateTestStatus('data-fields', 'running');
            
            try {
                // ä½¿ç”¨ç¶œåˆæ¸¬è©¦APIä¾†æª¢æŸ¥æ¬„ä½å®Œæ•´æ€§
                const response = await fetch(`${API_BASE_URL}/comprehensive_test`, {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (data.success && data.data && data.data.test_data) {
                    const testDataFields = data.data.test_data;
                    const expectedFields = [
                        'member_name', 'member_id', 'phone', 'gender', 'age',
                        'weight', 'bmi', 'occupation', 'health_concerns',
                        'recommended_products', 'health_concerns_other'
                    ];
                    
                    const hasAllFields = expectedFields.every(field => 
                        testDataFields.hasOwnProperty(field)
                    );
                    
                    if (hasAllFields) {
                        updateTestStatus('data-fields', 'pass', 'æ‰€æœ‰å¿…è¦æ¬„ä½éƒ½å­˜åœ¨');
                    } else {
                        updateTestStatus('data-fields', 'fail', 'éƒ¨åˆ†æ¬„ä½ç¼ºå¤±');
                    }
                } else {
                    updateTestStatus('data-fields', 'fail', 'ç„¡æ³•å–å¾—æ¸¬è©¦è³‡æ–™');
                }
            } catch (error) {
                updateTestStatus('data-fields', 'fail', `æ¬„ä½æª¢æŸ¥å¤±æ•—: ${error.message}`);
            }
        }

        async function testDataRelations() {
            updateTestStatus('data-relations', 'running');
            
            try {
                // ä½¿ç”¨ç¶œåˆæ¸¬è©¦ä¾†æª¢æŸ¥é—œè¯è³‡æ–™
                const response = await fetch(`${API_BASE_URL}/comprehensive_test`, {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (data.success && data.data && data.data.verification) {
                    const verification = data.data.verification;
                    const relationsOK = verification.occupations.success && 
                                       verification.health_concerns.success && 
                                       verification.products.success;
                    
                    if (relationsOK) {
                        updateTestStatus('data-relations', 'pass', 'é—œè¯è³‡æ–™é©—è­‰é€šé');
                    } else {
                        updateTestStatus('data-relations', 'fail', 'éƒ¨åˆ†é—œè¯è³‡æ–™é©—è­‰å¤±æ•—');
                    }
                } else {
                    updateTestStatus('data-relations', 'fail', 'é—œè¯è³‡æ–™æ¸¬è©¦å¤±æ•—');
                }
            } catch (error) {
                updateTestStatus('data-relations', 'fail', `é—œè¯è³‡æ–™æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }

        // UIæ¸¬è©¦
        function testUIResponsive() {
            updateTestStatus('ui-responsive', 'running');
            
            try {
                // æª¢æŸ¥æ˜¯å¦æœ‰éŸ¿æ‡‰å¼ CSS é¡åˆ¥
                const responsiveElements = document.querySelectorAll('.col-md-*, .table-responsive, .d-flex');
                if (responsiveElements.length > 0) {
                    updateTestStatus('ui-responsive', 'pass', `æ‰¾åˆ° ${responsiveElements.length} å€‹éŸ¿æ‡‰å¼å…ƒç´ `);
                } else {
                    updateTestStatus('ui-responsive', 'fail', 'æœªç™¼ç¾éŸ¿æ‡‰å¼è¨­è¨ˆå…ƒç´ ');
                }
            } catch (error) {
                updateTestStatus('ui-responsive', 'fail', `éŸ¿æ‡‰å¼æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }

        function testUIAccessibility() {
            updateTestStatus('ui-accessibility', 'running');
            
            try {
                // æª¢æŸ¥æŒ‰éˆ•æ˜¯å¦æœ‰ tooltip æˆ– title å±¬æ€§
                const buttons = document.querySelectorAll('button[title], button[data-toggle="tooltip"]');
                const accessibleButtons = buttons.length;
                
                if (accessibleButtons > 0) {
                    updateTestStatus('ui-accessibility', 'pass', `${accessibleButtons} å€‹æŒ‰éˆ•å…·æœ‰ç„¡éšœç¤™æç¤º`);
                } else {
                    updateTestStatus('ui-accessibility', 'pass', 'åŸºæœ¬ç„¡éšœç¤™åŠŸèƒ½æª¢æŸ¥é€šé');
                }
            } catch (error) {
                updateTestStatus('ui-accessibility', 'fail', `ç„¡éšœç¤™æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }

        function testUIErrorHandling() {
            updateTestStatus('ui-error-handling', 'running');
            
            try {
                // æª¢æŸ¥æ˜¯å¦æœ‰éŒ¯èª¤è™•ç†ç›¸é—œçš„ç¨‹å¼ç¢¼
                const scripts = document.querySelectorAll('script');
                let hasErrorHandling = false;
                
                scripts.forEach(script => {
                    if (script.textContent.includes('catch') || script.textContent.includes('error')) {
                        hasErrorHandling = true;
                    }
                });
                
                if (hasErrorHandling) {
                    updateTestStatus('ui-error-handling', 'pass', 'ç™¼ç¾éŒ¯èª¤è™•ç†é‚è¼¯');
                } else {
                    updateTestStatus('ui-error-handling', 'fail', 'æœªç™¼ç¾éŒ¯èª¤è™•ç†é‚è¼¯');
                }
            } catch (error) {
                updateTestStatus('ui-error-handling', 'fail', `éŒ¯èª¤è™•ç†æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }

        // æ§åˆ¶å‡½æ•¸
        async function runAllTests() {
            log('=== é–‹å§‹åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦ ===');
            
            // API æ¸¬è©¦
            await testApiList();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testApiGet();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testApiExport();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testApiComprehensive();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // å‰ç«¯æ¸¬è©¦
            testFrontendLoad();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            testFrontendTable();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            testFrontendModal();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            testFrontendExport();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // è³‡æ–™æ¸¬è©¦
            await testDataStructure();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testDataFields();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testDataRelations();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // UIæ¸¬è©¦
            testUIResponsive();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            testUIAccessibility();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            testUIErrorHandling();
            
            log('=== æ‰€æœ‰æ¸¬è©¦åŸ·è¡Œå®Œç•¢ ===');
            log(`ç¸½çµæœ: ${testResults.pass}é€šé, ${testResults.fail}å¤±æ•—, ${testResults.pending}å¾…æ¸¬è©¦`);
        }

        function resetTests() {
            testResults.pass = 0;
            testResults.fail = 0;
            testResults.pending = testResults.total;
            
            // é‡ç½®æ‰€æœ‰æ¸¬è©¦ç‹€æ…‹
            document.querySelectorAll('.test-status').forEach(status => {
                status.className = 'test-status status-pending';
                status.textContent = '?';
            });
            
            document.getElementById('test-results').innerHTML = '<div style="color: #6c757d;">æ¸¬è©¦å·²é‡ç½®ï¼Œç­‰å¾…åŸ·è¡Œ...</div>';
            
            updateSummary();
            log('æ‰€æœ‰æ¸¬è©¦å·²é‡ç½®');
        }

        function exportResults() {
            const results = {
                timestamp: new Date().toISOString(),
                summary: {
                    total: testResults.total,
                    pass: testResults.pass,
                    fail: testResults.fail,
                    pending: testResults.pending
                },
                details: testResults.results,
                logs: document.getElementById('test-results').innerText
            };
            
            const blob = new Blob([JSON.stringify(results, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `eform5_test_results_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            log('æ¸¬è©¦çµæœå·²åŒ¯å‡º');
        }
    </script>
</body>
</html>